<!DOCTYPE html>
<html>
<head>
	<title>Upgrading Artisan Android SDK</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="imagetoolbar" content="false">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta name="author" content="Artisan Mobile" />
	<meta name="description" content="Upgrading the Artisan Android SDK" />
	<meta name="keywords" content="" />

	<meta name="twitter:card" content="summary" />
	<meta name="twitter:url" content="http://dev.useartisan.com" />
	<meta name="twitter:title" content="Upgrading Artisan Android SDK" />
	<meta name="twitter:description" content="Upgrading the Artisan Android SDK" />
	<meta name="twitter:site" content="@artisanmobile" />
	<meta name="twitter:image" content="http://dev.useartisan.com/images/twitter-card-image.png" />

	<meta property="og:site_name" content="Artisan Developers" />
	<meta property="og:title" content="Upgrading Artisan Android SDK" />
	<meta property="og:type" content="article" />
	<meta property="og:article:author" content="Kevin M. Jackson" />
	<meta property="og:url" content="http://dev.useartisan.com" />
  
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="/js/waypoints.min.js"></script>
	<script src="/js/waypoints-sticky.min.js"></script>
	<script type="text/javascript" src="//use.typekit.net/zqm4dpz.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.2.0/base-min.css">
	<link rel="stylesheet" href="/docs.css?1392841087" type="text/css" media="screen" charset="utf-8">
</head>
<body>
<div id="header-wrapper">
	<nav>
		<ul id="primary-nav">
			<li><a href="/" title="" id="logo">
				<svg version="1.1" id="icon" fill="#ffffff" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="36px" width="36px" viewBox="0 0 144 144">
					<g>
						<path d="M11.001,97.171c12.574,0,21.169-8.989,26.592-14.575c-0.685,1.268-1.76,3.106-2.028,7.13c-0.343,5.146,2.883,7.41,6.523,7.41c11.756,0,21.49-15.313,26.176-20.028c3.151-3.17,4.429-3.686,7.166-3.686c1.515,0,2,1.4,2,2.468c0,4.489-7.395,10.992-7.395,15.779c0,3.286,2.102,5.503,7.392,5.503c8.67,0,16.73-7.361,18.731-9.294c-1.73,5.709,0.668,9.294,5.901,9.294c6.934,0,16.543-6.328,18.671-9.255c-0.95,4.409,0.461,9.255,6.01,9.255c5.165,0,10.585-3.469,17.261-9.328v-7.124c-5.301,4.903-9.864,8.877-12.489,8.877c-0.8,0-1.143-0.692-1.143-1.291c0-3.854,10.28-16.128,10.28-20.655c0-2.051-1.667-2.798-3.652-2.79c-2.535,0.01-4.433,0.689-6.143,2.992c-2.146,2.889-4.721,7.375-7.858,10.804c-5.518,6.033-11.253,10.61-14.825,10.61c-1.327,0-1.755-0.771-1.755-1.846c0-4.734,6.176-14.089,10.587-21.646c2.807,0.052,4.836,0.116,5.122,0.116c1.937,0,4.656-0.839,4.656-3.007c0-1.772-1.272-2.949-3.701-2.949c-0.142,0-1.253,0.032-2.968,0.069c0.773-1.667,1.249-3.067,1.249-4.053c0-2.164-0.864-4.023-3.485-3.974c-2.524,0.047-5.582,2.392-8.99,8.136c-5.198-0.027-10.569-0.179-11.096-0.178c-2.483,0-4.674,0.907-4.674,3.094c0,2.082,1.188,2.863,3.499,2.863c0.334,0,4.361-0.109,9.246-0.159c-1.829,3.412-4.306,7.692-7.173,11.688c-4.651,6.479-11.596,11.916-15.848,11.916c-1.344,0-1.607-0.869-1.607-1.723c0-3.468,8.203-11.075,8.203-17.023c0-4.28-4.111-5.701-9.468-5.701c-7.307,0-10.27,1.476-15.537,8.155c-6.085,7.717-14.254,15.772-16.664,15.772c-0.734,0-0.69-1.003-0.645-1.334c0.647-4.726,8.411-14.897,8.756-20.074c0.286-4.287-5.133-5.817-9.356-2.197c-0.778,0.667-20.761,23.426-30.816,23.426c-2.227,0-3.5-1.071-3.5-4.08c0-10.111,15.907-30.34,33.532-30.34c8.127,0,8.339,1.667,12.401,1.667c2.846,0,4.268-1.581,4.268-3.371c0-5.239-6.555-5.683-11.577-5.683C27.471,46.829,0,67.646,0,85.769C0,94.921,6.029,97.171,11.001,97.171z"/>
						<path d="M138.128,55.695c0,2.164,1.623,4.103,4.181,4.103c0.596,0,1.161-0.063,1.691-0.179V50.15c-0.059-0.002-0.108-0.015-0.168-0.015C141.424,50.135,138.128,51.694,138.128,55.695z"/>
					</g>
					<path d="M141,3v138H3V3H141 M144,0H0v144h144V0L144,0z"/>
				</svg>
			</a></li>
			<li><a href="/user-guide" title="">Getting Started</a></li>
			<li><a href="/dev/ios/install" title="">iOS Developers</a></li>
			<li><a href="/dev/android/install" title="">Android Developers</a></li>
		</ul>

		<ul id="extra-links">
			<li><a href="http://useartisan.com" title="">Artisan Home</a></li>
			<li><a href="http://useartisan.com/blog" title="">Blog</a></li>
		</ul>
	</nav>
</div>
<div id="main">
  <div class="main-wrapper">
    <section>
      <aside id="category-nav">
        <div id="nav-wrapper">
          





        </div>
      </aside>
      <article>
        <h1 id="upgrading-the-artisan-android-sdk">Upgrading the Artisan Android SDK</h1>

<p>Typically upgrading is a simple process. All you need to do is get a new copy of the Artisan SDK from Artisan Tools, and expand and install it just as you did the first time. However with some versions there are additional steps required. See below for the process for upgrading from specific versions of Artisan.</p>

<p>As a general best practice when upgrading, you should delete the artisan directory in your project root.</p>

<p>You can delete it from your filesystem explorer, Finder, or from your favorite IDE. Or, you can delete it from a terminal:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># run this in a terminal</span>
<span class="c"># navigate to your project&#39;s root folder (where AndroidManifest.xml is)</span>
rm -rf artisan</code></pre></div>

<div class="note note-hint">
  <p>Questions about installing or upgrading? We are always more than happy to help! Send an email to <a href="mailto:support@useartisan.com?Subject=Android%20SDK%20Upgrade%20Help" target="_top">support@useartisan.com</a> or give us a call at 800.594.0401.</p>
</div>

<h2 id="upgrading-from-artisan-210-to-211">Upgrading from Artisan 2.1.0 to 2.1.1+</h2>

<p>As of Artisan 2.1.1 we have moved the location of that Artisan initialization from a sublcass of the ArtisanService to your Application class.</p>

<h3 id="go-ahead-and-run-the-installer-for-the-latest-version-of-artisan">1. Go ahead and run the installer for the latest version of Artisan</h3>

<div class="highlight"><pre><code class="bash"><span class="c"># run this in a terminal</span>
<span class="c"># navigate to your project&#39;s root folder (where AndroidManifest.xml is)</span>
rm -rf artisan</code></pre></div>

<p>In a terminal, go to the artisan directory inside your project's root directory and run:</p>

<ul>
  <li>install.bat (on Windows)</li>
  <li>sh install.sh (on Mac/OSX or linux)</li>
</ul>

<h3 id="update-your-application-class-to-extend-artisanapplication-or-implement-artisanregisteredapplication">2. Update your Application class to extend ArtisanApplication or implement ArtisanRegisteredApplication</h3>

<p>Your Application Class needs to extend our class or implement our interface. Create a new Application class if you don’t already have one.</p>

<div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">com.artisan.application.ArtisanApplication</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySampleApplication</span> <span class="kd">extends</span> <span class="n">ArtisanApplication</span> <span class="o">{</span></code></pre></div>

<p>OR</p>

<div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">com.artisan.application.ArtisanRegisteredApplication</span><span class="o">;</span>

    <span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySampleApplication</span> <span class="kd">extends</span> <span class="n">Application</span> <span class="kd">implements</span> <span class="n">ArtisanRegisteredApplication</span> <span class="o">{</span></code></pre></div>

<div class="note note-hint">
FYI, if you just created your Application class, you have to reference it in the android:name property of the &lt;application&gt; element in your AndroidManifest.xml.


<div class="highlight"><pre><code class="java"><span class="o">&lt;</span><span class="n">application</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;.MySampleApplication&quot;</span> <span class="o">...&gt;</span></code></pre></div>

</div>

<h3 id="implement-required-methods-for-artisanregisteredapplication">3. Implement required methods for ArtisanRegisteredApplication</h3>

<p>The ArtisanRegisteredApplication has three required methods on it: <strong>registerUserProfileVariables</strong>, <strong>registerPowerhooks</strong>, and <strong>registerInCodeExperiments</strong>.</p>

<ul>
  <li>Since you are upgrading you may have implemented these methods on your CustomArtisanService. If so, you can simply move those methods from your CustomArtisanService to your Application class.</li>
</ul>

<p>Feel free to copy and paste these samples:</p>

<div class="highlight"><pre><code class="java"><span class="cm">/**</span>
<span class="cm"> * Register your Artisan Power Hook variables and Power Hook blocks here</span>
<span class="cm"> *</span>
<span class="cm"> * For example:</span>
<span class="cm"> *</span>
<span class="cm"> * PowerHookManager.registerVariable(&quot;WelcomeText&quot;, &quot;Welcome Text Sample PowerHook&quot;, &quot;Welcome to Artisan!&quot;);</span>
<span class="cm"> *</span>
<span class="cm"> * &lt;code&gt;</span>
<span class="cm"> *  HashMap&lt;String, String&gt; defaultData = new HashMap&lt;String, String&gt;();</span>
<span class="cm"> *  defaultData.put(&quot;discountCode&quot;, &quot;012345ABC&quot;);</span>
<span class="cm"> *  defaultData.put(&quot;discountAmount&quot;, &quot;25%&quot;);</span>
<span class="cm"> *  defaultData.put(&quot;shouldDisplay&quot;, &quot;true&quot;);</span>
<span class="cm"> *</span>
<span class="cm"> *  PowerHookManager.registerBlock(&quot;showAlert&quot;, &quot;Show Alert Block&quot;, defaultData, new ArtisanBlock() {</span>
<span class="cm"> *    public void execute(Map&lt;String, String&gt; data, Map&lt;String, Object&gt; extraData) {</span>
<span class="cm"> *      if (&quot;true&quot;.equalsIgnoreCase(data.get(&quot;shouldDisplay&quot;))) {</span>
<span class="cm"> *        StringBuilder message = new StringBuilder();</span>
<span class="cm"> *        message.append(&quot;Buy another for a friend! Use discount code &quot;);</span>
<span class="cm"> *        message.append(data.get(&quot;discountCode&quot;));</span>
<span class="cm"> *        message.append(&quot; to get &quot;);</span>
<span class="cm"> *        message.append(data.get(&quot;discountAmount&quot;));</span>
<span class="cm"> *        message.append(&quot; off your purchase of 2 or more!&quot;);</span>
<span class="cm"> *        Toast.makeText((Context) extraData.get(&quot;context&quot;), message, Toast.LENGTH_LONG).show();</span>
<span class="cm"> *      }</span>
<span class="cm"> *    }</span>
<span class="cm"> * });</span>
<span class="cm"> * &lt;/code&gt;</span>
<span class="cm"> *</span>
<span class="cm"> * More examples at http://docs.useartisan.com/dev/quickstart-for-android/#power-hooks</span>
<span class="cm"> *</span>
<span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerPowerhooks</span><span class="o">()</span> <span class="o">{</span>

<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm"> * Register your Artisan In-code Experiments here</span>
<span class="cm"> *</span>
<span class="cm"> * For example:</span>
<span class="cm"> *</span>
<span class="cm"> * ArtisanExperimentManager.registerExperiment(&quot;my first experiment&quot;);</span>
<span class="cm"> * ArtisanExperimentManager.addVariantForExperiment(&quot;blue variation&quot;, &quot;my first experiment&quot;);</span>
<span class="cm"> * ArtisanExperimentManager.addVariantForExperiment(&quot;green variation&quot;, &quot;my first experiment&quot;);</span>
<span class="cm"> *</span>
<span class="cm"> * More examples at http://docs.useartisan.com/dev/quickstart-for-android/#in-code</span>
<span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerInCodeExperiments</span><span class="o">()</span> <span class="o">{</span>

<span class="o">}</span>

<span class="cm">/**</span>
<span class="cm"> * Register your Artisan In-code Experiments here</span>
<span class="cm"> *</span>
<span class="cm"> * For example:</span>
<span class="cm"> *</span>
<span class="cm"> * ArtisanProfileManager.registerDateTime(&quot;lastSeenAt&quot;, new Date());</span>
<span class="cm"> * ArtisanProfileManager.registerLocation(&quot;lastKnownLocation&quot;);</span>
<span class="cm"> * ArtisanProfileManager.registerNumber(&quot;totalOrderCount&quot;, ArtisanDemoApplication.totalOrderCount);</span>
<span class="cm"> * ArtisanProfileManager.registerString(&quot;visitorType&quot;, &quot;anonymous&quot;);</span>
<span class="cm"> * ArtisanProfileManager.setGender(Gender.Female);</span>
<span class="cm"> * ArtisanProfileManager.setUserAge(29);</span>
<span class="cm"> * ArtisanProfileManager.setSharedUserId(&quot;abcdef123456789&quot;);</span>
<span class="cm"> * ArtisanProfileManager.setUserAddress(&quot;234 Market Street, Philadelphia, PA 19106&quot;);</span>
<span class="cm"> *</span>
<span class="cm"> * More examples at http://docs.useartisan.com/dev/quickstart-for-android/#api</span>
<span class="cm"> */</span>
<span class="nd">@Override</span>
<span class="kd">public</span> <span class="kt">void</span> <span class="nf">registerUserProfileVariables</span><span class="o">()</span> <span class="o">{</span>

<span class="o">}</span></code></pre></div>

<h3 id="move-startartisan-code">4. Move startArtisan code</h3>

<p>Your CustomArtisanService probably has code like this:</p>

<div class="highlight"><pre><code class="java"><span class="kd">public</span> <span class="kd">class</span> <span class="nc">CustomArtisanService</span> <span class="kd">extends</span> <span class="n">ArtisanService</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">startArtisanManager</span><span class="o">(</span><span class="n">ArtisanManager</span> <span class="n">artisanManager</span><span class="o">)</span> <span class="o">{</span>
      <span class="c1">// REMOVE THIS</span>
      <span class="n">artisanManager</span><span class="o">.</span><span class="na">start</span><span class="o">(</span><span class="s">&quot;52a5d8482b222086ae00001f&quot;</span><span class="o">);</span>
  <span class="o">}</span></code></pre></div>

<p>This should move to your Application class onCreate method in a new form:</p>

<div class="highlight"><pre><code class="java"><span class="kn">import</span> <span class="nn">com.artisan.application.ArtisanApplication</span><span class="o">;</span>
<span class="kn">import</span> <span class="nn">com.artisan.manager.ArtisanManager</span><span class="o">;</span>

<span class="kd">public</span> <span class="kd">class</span> <span class="nc">MySampleApplication</span> <span class="kd">extends</span> <span class="n">ArtisanApplication</span> <span class="o">{</span>

  <span class="nd">@Override</span>
  <span class="kd">public</span> <span class="kt">void</span> <span class="nf">onCreate</span><span class="o">()</span> <span class="o">{</span>
      <span class="kd">super</span><span class="o">.</span><span class="na">onCreate</span><span class="o">();</span>
      <span class="c1">// ADD THIS, pass in a reference to your Application class and your Artisan AppID</span>
      <span class="n">ArtisanManager</span><span class="o">.</span><span class="na">startArtisan</span><span class="o">(</span><span class="k">this</span><span class="o">,</span> <span class="s">&quot;52a5d8482b222086ae00001f&quot;</span><span class="o">);</span>
  <span class="o">}</span></code></pre></div>

<h3 id="update-your-androidmanifestxml-to-remove-the-old-service-class">5. Update your AndroidManifest.xml to remove the old Service class</h3>

<p>Remove this from your AndroidManifest.xml</p>

<div class="highlight"><pre><code class="java"><span class="o">&lt;</span><span class="n">service</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;.CustomArtisanService&quot;</span><span class="o">/&gt;</span></code></pre></div>

<p>And add this if it isn’t there already. If you ran the installer in Step 1, then this should already be in your manifest:</p>

<div class="highlight"><pre><code class="java"><span class="o">&lt;</span><span class="n">service</span> <span class="nl">android:</span><span class="n">name</span><span class="o">=</span><span class="s">&quot;com.artisan.services.ArtisanService&quot;</span><span class="o">/&gt;</span></code></pre></div>

<p>You can actually delete the CustomArtisanService file now, assuming that you have moved all of the user profile variable, power hook and in-code experiment configuration to your Application class already.</p>

<p>All done! With this change we have solved issues where the Artisan API wasn’t always ready in th onCreate, onStart, or onResume for the first Activity of the app.</p>

<h2 id="upgrading-from-artisan-20x-version-installed-before-april-30-2014">Upgrading from Artisan 2.0.x (Version installed before April 30, 2014)</h2>

<div class="note note-important">
  <p>Artisan Android 2.0.x used AspectJ. <strong>As of Artisan 2.1.0 the new default for Artisan Android does not use AspectJ</strong>, although that is still an option for auto-instrumentation. If you wish to continue using <a href="/dev/android-aspectj/">Artisan Auto-Instrumentation with AspectJ</a> you may, but you should still complete the steps below.</p>
</div>

<p>If you are upgrading from Artisan 2.0.x, then there are a few steps you will need to take to transition:</p>

<h3 id="remove-aspectj-nature">1. Remove AspectJ Nature</h3>

<p>In Eclipse, remove the AspectJ project nature by right clicking on your project and choosing AspectJ Tools -&gt; Remove AspectJ Nature</p>

<p><img src="/images/remove_aspectj_capability.png" /></p>

<div class="note note-hint">
  <p>You may skip this step if you would like to opt to continue using <a href="/dev/android-aspectj/">Artisan Auto-Instrumentation with AspectJ</a>.</p>
</div>

<h3 id="remove-old-artisan-jar-from-build-path">2. Remove old Artisan jar from Build Path</h3>

<p>Also in Eclipse remove the <strong>artisan_library_4.jar</strong> from your Java Build Path.</p>

<ol>
  <li>Right click on your project in the Project Explorer again and choose "Properties"</li>
  <li>Then in the list on the left, click on "Java Build Path"</li>
  <li>Select the <strong>artisan_library_4.jar</strong> if it is there</li>
  <li>Click the "Remove" button</li>
</ol>

<p><img src="/images/remove_old_android_jar.png" /></p>

<ul>
  <li>You may see compile errors in Eclipse when you do this. They will be resolved when you complete the installation of the new version of Artisan.</li>
</ul>

<div class="note note-hint">
  <p>If you are going to continue using <a href="/dev/android-aspectj/">Artisan Auto-Instrumentation with AspectJ</a> you also should remove the old jar from your AspectJ inpath as well.</p>
</div>

<h3 id="clean-out-old-artisan-artifacts">3. Clean out old Artisan artifacts</h3>

<p>As with all upgrades, you should start by removing the artisan folder in the root of your project directory. You can also remove the artisan_library folder because you won’t be needing that anymore.</p>

<p>You can delete these folders from your filesystem explorer, Finder, or from your favorite IDE. Or, you can delete it from a terminal:</p>

<div class="highlight"><pre><code class="bash"><span class="c"># run this in a terminal</span>
<span class="c"># navigate to your project&#39;s root folder (where AndroidManifest.xml is)</span>
rm -rf artisan artisan_library</code></pre></div>

<h3 id="remove-old-artisan-dependencies">4. Remove old Artisan Dependencies</h3>

<p>You can safely remove any dependencies from your libs folder that were added when you first installed Artisan, <strong>assuming that your app doesn’t also depend on them</strong>. Artisan’s old dependencies were:</p>

<ul>
    <li>android-support-v4.jar</li>
    <li>httpclientandroidlib-1.1.2.jar</li>
    <li>jackson-annotations-2.2.3.jar</li>
    <li>jackson-core-2.2.3.jar</li>
    <li>jackson-databind-2.2.3.jar</li>
    <li>otto-1.3.4.jar</li>
    <li>volley.jar (built from source)</li>
</ul>

<h3 id="clean-up-intellij-and-ant-config-if-applicable">5. Clean up IntelliJ and Ant config (if applicable)</h3>

<p>If you had set up your IntelliJ or Ant project for Artisan AspectJ you can remove that special configuration unless you are opting to continue using <a href="/dev/android-aspectj/">Artisan Auto-Instrumentation with AspectJ</a>.</p>

<p>Details about what that configuration was can be found on <a href="/dev/android-aspectj/">the Artisan AspectJ page</a>.</p>

<h3 id="proceed-with-installation">6. Proceed with Installation</h3>

<p>Enjoy a leaner and simpler Artisan SDK! Please follow <a href="/dev/quickstart-for-android/">new Android installation instructions</a> to complete the installation of the Artisan SDK.</p>

<div class="note note-hint">
  <p>If you are opting to continue using Artisan Auto-Instrumentation with AspectJ please use <a href="/dev/android-aspectj/">these instructions</a> instead.</p>
</div>

      </article>
    </section>
  </div>
</div>
<footer>
	<div id="footer" class="wrapper">Copyright  Artisan Mobile, Inc. All rights reserved.</div>
</footer>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		function toStickOrNotToStick () {
			wHeight = $(window).height();
			navHeight = $("#nav-wrapper").outerHeight(true);

			if(wHeight > navHeight ) {
				if($('#category-nav .sticky-wrapper').length == 0) {
					$('#category-nav #nav-wrapper').waypoint('sticky');
				}
			} else {
				$('#category-nav #nav-wrapper').waypoint('unsticky');
			}

			if($('#category-nav').is(':hidden')) {
				$('#category-nav #nav-wrapper').waypoint('unsticky');	
			}
		}

		$(window).resize(function() {
			toStickOrNotToStick();
		});

		toStickOrNotToStick();
	})
</script>
</body>
</html>