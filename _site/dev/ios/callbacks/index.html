<!DOCTYPE html>
<html>
<head>
	<title>Callbacks</title>
	<meta http-equiv="Content-Type" content="text/html; charset=utf-8">
	<meta http-equiv="imagetoolbar" content="false">
	<meta name="viewport" content="width=device-width, initial-scale=1.0">

	<meta name="author" content="Artisan Mobile" />
	<meta name="description" content="Callbacks for the Artisan iOS SDK" />
	<meta name="keywords" content="" />

	<meta name="twitter:card" content="summary" />
	<meta name="twitter:url" content="http://dev.useartisan.com" />
	<meta name="twitter:title" content="Callbacks" />
	<meta name="twitter:description" content="Callbacks for the Artisan iOS SDK" />
	<meta name="twitter:site" content="@artisanmobile" />
	<meta name="twitter:image" content="http://dev.useartisan.com/images/twitter-card-image.png" />

	<meta property="og:site_name" content="Artisan Developers" />
	<meta property="og:title" content="Callbacks" />
	<meta property="og:type" content="article" />
	<meta property="og:article:author" content="Kevin M. Jackson" />
	<meta property="og:url" content="http://dev.useartisan.com" />
  
	<script src="//ajax.googleapis.com/ajax/libs/jquery/1.10.2/jquery.min.js"></script>
	<script src="/js/waypoints.min.js"></script>
	<script src="/js/waypoints-sticky.min.js"></script>
	<script type="text/javascript" src="//use.typekit.net/zqm4dpz.js"></script>
	<script type="text/javascript">try{Typekit.load();}catch(e){}</script>

	<link rel="stylesheet" href="http://yui.yahooapis.com/pure/0.2.0/base-min.css">
	<link rel="stylesheet" href="/docs.css?1392841087" type="text/css" media="screen" charset="utf-8">
</head>
<body>
<div id="header-wrapper">
	<nav>
		<ul id="primary-nav">
			<li><a href="/" title="" id="logo">
				<svg version="1.1" id="icon" fill="#ffffff" xmlns="http://www.w3.org/2000/svg" xmlns:xlink="http://www.w3.org/1999/xlink" height="36px" width="36px" viewBox="0 0 144 144">
					<g>
						<path d="M11.001,97.171c12.574,0,21.169-8.989,26.592-14.575c-0.685,1.268-1.76,3.106-2.028,7.13c-0.343,5.146,2.883,7.41,6.523,7.41c11.756,0,21.49-15.313,26.176-20.028c3.151-3.17,4.429-3.686,7.166-3.686c1.515,0,2,1.4,2,2.468c0,4.489-7.395,10.992-7.395,15.779c0,3.286,2.102,5.503,7.392,5.503c8.67,0,16.73-7.361,18.731-9.294c-1.73,5.709,0.668,9.294,5.901,9.294c6.934,0,16.543-6.328,18.671-9.255c-0.95,4.409,0.461,9.255,6.01,9.255c5.165,0,10.585-3.469,17.261-9.328v-7.124c-5.301,4.903-9.864,8.877-12.489,8.877c-0.8,0-1.143-0.692-1.143-1.291c0-3.854,10.28-16.128,10.28-20.655c0-2.051-1.667-2.798-3.652-2.79c-2.535,0.01-4.433,0.689-6.143,2.992c-2.146,2.889-4.721,7.375-7.858,10.804c-5.518,6.033-11.253,10.61-14.825,10.61c-1.327,0-1.755-0.771-1.755-1.846c0-4.734,6.176-14.089,10.587-21.646c2.807,0.052,4.836,0.116,5.122,0.116c1.937,0,4.656-0.839,4.656-3.007c0-1.772-1.272-2.949-3.701-2.949c-0.142,0-1.253,0.032-2.968,0.069c0.773-1.667,1.249-3.067,1.249-4.053c0-2.164-0.864-4.023-3.485-3.974c-2.524,0.047-5.582,2.392-8.99,8.136c-5.198-0.027-10.569-0.179-11.096-0.178c-2.483,0-4.674,0.907-4.674,3.094c0,2.082,1.188,2.863,3.499,2.863c0.334,0,4.361-0.109,9.246-0.159c-1.829,3.412-4.306,7.692-7.173,11.688c-4.651,6.479-11.596,11.916-15.848,11.916c-1.344,0-1.607-0.869-1.607-1.723c0-3.468,8.203-11.075,8.203-17.023c0-4.28-4.111-5.701-9.468-5.701c-7.307,0-10.27,1.476-15.537,8.155c-6.085,7.717-14.254,15.772-16.664,15.772c-0.734,0-0.69-1.003-0.645-1.334c0.647-4.726,8.411-14.897,8.756-20.074c0.286-4.287-5.133-5.817-9.356-2.197c-0.778,0.667-20.761,23.426-30.816,23.426c-2.227,0-3.5-1.071-3.5-4.08c0-10.111,15.907-30.34,33.532-30.34c8.127,0,8.339,1.667,12.401,1.667c2.846,0,4.268-1.581,4.268-3.371c0-5.239-6.555-5.683-11.577-5.683C27.471,46.829,0,67.646,0,85.769C0,94.921,6.029,97.171,11.001,97.171z"/>
						<path d="M138.128,55.695c0,2.164,1.623,4.103,4.181,4.103c0.596,0,1.161-0.063,1.691-0.179V50.15c-0.059-0.002-0.108-0.015-0.168-0.015C141.424,50.135,138.128,51.694,138.128,55.695z"/>
					</g>
					<path d="M141,3v138H3V3H141 M144,0H0v144h144V0L144,0z"/>
				</svg>
			</a></li>
			<li><a href="/user-guide" title="">Getting Started</a></li>
			<li><a href="/dev/ios/install" title="">iOS Developers</a></li>
			<li><a href="/dev/android/install" title="">Android Developers</a></li>
		</ul>

		<ul id="extra-links">
			<li><a href="http://useartisan.com" title="">Artisan Home</a></li>
			<li><a href="http://useartisan.com/blog" title="">Blog</a></li>
		</ul>
	</nav>
</div>
<div id="main">
  <div class="main-wrapper">
    <section>
      <aside id="category-nav">
        <div id="nav-wrapper">
          


  <h2>iOS SDK</h2>
  <ul>
    <li><a href="/dev/ios/install/">Installation</a></li>
    <li><a href="/dev/ios/user-profiles/">User Profiles</a></li>
    <li><a href="/dev/ios/event-tracking/">Event Tracking</a></li>
    <li><a href="/dev/ios/power-hooks/">Power Hooks</a></li>
    <li><a href="/dev/ios/push-notifications/">Push Notifications</a></li>
    <li><a href="/dev/ios/incode-experiments/">In-Code Experiments</a></li>
    <li><a href="/dev/ios/callbacks/">Callbacks</a></li>
    <li><a href="/dev/ios/appledocs/">API Appledocs</a></li>
  </ul>




        </div>
      </aside>
      <article>
        <h1 id="callbacks">Callbacks</h1>

<p>If you would like to hold up your app and wait for that first playlist to be downloaded, or desire to change something in your app immediately, you can leverage our callback functionality. </p>

<ul>
  <li><a href="#playlist">Playlist Callbacks</a></li>
  <li><a href="#power-hook">Power Hook Callbacks</a></li>
</ul>

<div id="playlist"></div>

<h2 id="playlist-callbacks">Playlist Callbacks</h2>

<p>When your app is started Artisan will fetch the latest changes from the Artisan Service. If you would like to hold up your app and wait for that first playlist to be downloaded, you can use the ARManager <strong>onFirstPlaylistDownloaded:withTimeout:</strong> method.</p>

<p>This call is non-blocking so code execution will continue immediately to the next line of code.</p>

<p>Here is an example where I wait for no more than 3 seconds for the first playlist to download:</p>

<div class="highlight"><pre><code class="objective-c"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
    <span class="n">waitingViewController</span> <span class="o">=</span> <span class="p">[[</span><span class="n">MYSampleWaitingViewController</span> <span class="n">alloc</span><span class="p">]</span> <span class="n">init</span><span class="p">];</span>

    <span class="p">[</span><span class="n">self</span> <span class="n">presentViewController</span><span class="o">:</span><span class="n">waitingViewController</span> <span class="n">animated</span><span class="o">:</span><span class="nb">NO</span> <span class="n">completion</span><span class="o">:</span><span class="nb">nil</span><span class="p">];</span>

    <span class="n">__block</span> <span class="n">MYSampleHomeScreenViewController</span> <span class="o">*</span><span class="n">_self</span> <span class="o">=</span> <span class="n">self</span><span class="p">;</span>

    <span class="p">[</span><span class="n">ARManager</span> <span class="n">onFirstPlaylistDownloaded</span><span class="o">:^</span><span class="p">{</span>
        <span class="c1">// this will be executed when the first playlist is downloaded or after 3 seconds, which ever is first.</span>
        <span class="p">[</span><span class="n">_self</span> <span class="n">hideWaitingViewController</span><span class="p">];</span>
    <span class="p">}</span> <span class="n">withTimeout</span><span class="o">:</span><span class="mi">3</span><span class="p">];</span>
<span class="p">}</span></code></pre></div>

<div class="note note-hint">
  <p><strong>A NOTE ON THREADING:</strong> The thread calling the block of code is guaranteed to be the main thread.  If the code inside of the block requires executing on a background thread you will need to implement this logic.</p>
  <p>If the first playlist has already been downloaded when this call is made this becomes a blocking call and the block of code is executed immediately.</p>
</div>

<div id="power-hook"></div>

<h2 id="power-hook-callbacks">Power Hook Callbacks</h2>

<p>When new Power Hook values come down from Artisan you might want the option to change something in your app immediately rather than waiting for the view controller to disappear and appear again.</p>

<p>You can register callbacks for when an individual power hook changes or when any power hook changes. This is typically done in one of your view controllers.</p>

<h3 id="when-individual-power-hook-values-change">When individual Power Hook Values change</h3>
<p>For individual Power Hook values you can get a reference to an ARPowerHookVariable to register a callback for when the value is updated.</p>

<div class="highlight"><pre><code class="objective-c"><span class="k">@interface</span> <span class="nc">MYSampleViewController</span> <span class="p">()</span>
<span class="p">{</span>
  <span class="n">ARPowerHookVariable</span> <span class="o">*</span><span class="n">marketingMessageVariable</span><span class="p">;</span>
<span class="p">}</span>
<span class="k">@end</span>

<span class="k">@implementation</span> <span class="nc">MYSampleViewController</span>

<span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewDidLoad</span> <span class="p">{</span>
  <span class="c1">// get a reference to the ARPowerHookVariable</span>
  <span class="n">marketingMessageVariable</span> <span class="o">=</span> <span class="p">[</span><span class="n">ARPowerHookManager</span> <span class="n">getPowerHookVariable</span><span class="o">:</span><span class="s">@&quot;marketingMessage&quot;</span><span class="p">];</span>
<span class="p">}</span></code></pre></div>

<p>Here is an example of registering a callback with the “marketingMessage” Power Hook value changes.</p>

<div class="highlight"><pre><code class="objective-c"><span class="k">-</span> <span class="p">(</span><span class="kt">void</span><span class="p">)</span><span class="nf">viewWillAppear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
    <span class="p">[</span><span class="n">marketingMessageVariable</span> <span class="n">onPowerHookChanged</span><span class="o">:^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">previewMode</span><span class="p">)</span> <span class="p">{</span>
      <span class="k">if</span> <span class="p">(</span><span class="n">previewMode</span><span class="p">)</span> <span class="p">{</span>
        <span class="c1">// you might only want to change a value on the screen if you are in Artisan previewMode</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;In Preview Mode! Updated Marketing Message is: %@&quot;</span><span class="p">,</span> <span class="n">marketingMessageVariable</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
      <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
        <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Updated Marketing Message is: %@&quot;</span><span class="p">,</span> <span class="n">marketingMessageVariable</span><span class="p">.</span><span class="n">value</span><span class="p">);</span>
      <span class="p">}</span>
    <span class="p">}];</span>
<span class="p">}</span></code></pre></div>

<p>Artisan provides a previewMode flag to tell you if you are currently in <a href="#preview-mode">Artisan Preview Mode</a>, previewing unpublished changes for your App. For example, you may want to only change text on the screen immediately if you are in previewMode. This will make it easier to preview Power Hook values in your app while you are considering changes in Artisan Tools.</p>

<div class="note note-hint">
  <p><strong>A NOTE ON THREADING:</strong> The thread calling the block of code is guaranteed to be the main thread.  If the code inside of the block requires executing on a background thread you will need to implement this logic.</p>
</div>

<p>To avoid memory leaks, it is important that you also unregister your callback in the parallel method to the one in which you registered it. For example, if you registered in <strong>viewWillAppear</strong> it is best to unregister in <strong>viewWillDisappear</strong>.</p>

<div class="highlight"><pre><code class="objective-c"><span class="k">-</span><span class="p">(</span><span class="kt">void</span><span class="p">)</span> <span class="nf">viewWillDisappear:</span><span class="p">(</span><span class="kt">BOOL</span><span class="p">)</span><span class="nv">animated</span> <span class="p">{</span>
  <span class="p">[</span><span class="n">marketingMessageVariable</span> <span class="n">unregisterPowerHookChanged</span><span class="p">];</span>
<span class="p">}</span></code></pre></div>

<h3 id="when-any-power-hook-value-changes">When any Power Hook Value changes</h3>

<p>If there are many power hooks that are used on an individual screen it may make sense to add a callback for when any power hook changes. Here is an example:</p>

<p>Just as with the individual power hook value callbacks you have the previewMode flag to tell you if you are currently in <a href="#preview-mode">Artisan Preview Mode</a>, previewing unpublished changes for your App.</p>

<div class="highlight"><pre><code class="objective-c"><span class="p">[</span><span class="n">ARPowerHookManager</span> <span class="n">onPowerHooksChanged</span><span class="o">:^</span><span class="p">(</span><span class="kt">BOOL</span> <span class="n">previewMode</span><span class="p">)</span> <span class="p">{</span>
  <span class="k">if</span> <span class="p">(</span><span class="n">previewMode</span><span class="p">)</span> <span class="p">{</span>
    <span class="c1">// you might only want to change a value on the screen if you are in Artisan previewMode</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;In Preview Mode! Power Hooks Changed!&quot;</span><span class="p">);</span>
  <span class="p">}</span> <span class="k">else</span> <span class="p">{</span>
    <span class="n">NSLog</span><span class="p">(</span><span class="s">@&quot;Power Hooks Changed!&quot;</span><span class="p">);</span>
  <span class="p">}</span>
<span class="p">}];</span></code></pre></div>

<div class="note note-hint">
  <p><strong>A NOTE ON THREADING:</strong> The thread calling the block of code is guaranteed to be the main thread.  If the code inside of the block requires executing on a background thread you will need to implement this logic.</p>
</div>

      </article>
    </section>
  </div>
</div>
<footer>
	<div id="footer" class="wrapper">Copyright  Artisan Mobile, Inc. All rights reserved.</div>
</footer>

<script type="text/javascript" charset="utf-8">
	$(document).ready(function() {
		function toStickOrNotToStick () {
			wHeight = $(window).height();
			navHeight = $("#nav-wrapper").outerHeight(true);

			if(wHeight > navHeight ) {
				if($('#category-nav .sticky-wrapper').length == 0) {
					$('#category-nav #nav-wrapper').waypoint('sticky');
				}
			} else {
				$('#category-nav #nav-wrapper').waypoint('unsticky');
			}

			if($('#category-nav').is(':hidden')) {
				$('#category-nav #nav-wrapper').waypoint('unsticky');	
			}
		}

		$(window).resize(function() {
			toStickOrNotToStick();
		});

		toStickOrNotToStick();
	})
</script>
</body>
</html>